# C++ Module 06 - Type Casting, Serialization, and RTTI

## 概要

C++ Module 06では、以下の重要なC++の概念を学びます：

- **型変換（Type Casting）**：静的・動的キャストの使い分け
- **シリアライゼーション（Serialization）**：データの永続化と復元
- **RTTI（Run-Time Type Information）**：実行時型情報の活用

このモジュールを通じて、C++の型システムの深い理解と、データの安全な変換・保存方法を習得します。

---

## ルール

- C++98準拠で開発すること
- `-Wall -Wextra -Werror -std=c++98` オプションを用いてコンパイル
- STLの使用は禁止（Module 08以降のみ許可）
- `printf`, `malloc`, `free` などのC関数は禁止
- `using namespace` や `friend` の使用も禁止
- メモリリークを避けること（`new` で確保したら `delete` を忘れずに）

---

## 各課題の概要

### ex00 - Convert scalar types

**概要**:  
文字列リテラルをC++の基本型（`char`, `int`, `float`, `double`）に変換するプログラム。

**実装内容**:
- `ScalarConverter` クラス（静的メソッドのみ、インスタンス化禁止）
- 文字列から型を自動判定し、適切な型に変換
- 変換不可能な場合は適切なエラーメッセージを表示
- 各型での表示形式を統一

**技術的ポイント**:
- 文字列解析と型判定
- 数値の範囲チェック
- 特殊値（`inf`, `nan`など）の処理
- オーバーフロー・アンダーフローの検出

---

### ex01 - Serialize data!

**概要**:  
データ構造をメモリアドレスに変換し、後で復元するシリアライゼーション機能。

**実装内容**:
- `Data` 構造体（`std::string` と `int` を含む）
- `Serializer` クラス（静的メソッドのみ）
- `serialize()`: ポインタを `uintptr_t` に変換
- `deserialize()`: `uintptr_t` からポインタを復元

**技術的ポイント**:
- ポインタと整数型の相互変換
- メモリアドレスの安全な保存
- C++98での `uintptr_t` の代替（`unsigned long`）
- データの整合性確保

---

### ex02 - Identify real type

**概要**:  
RTTI（実行時型情報）を活用して、基底クラスポインタから実際の型を特定する。

**実装内容**:
- `Base` 基底クラス（仮想デストラクタを持つ）
- `A`, `B`, `C` 派生クラス
- `identify()` 関数：`Base*` から実際の型を判定
- `generate()` 関数：ランダムに派生クラスのインスタンスを生成

**技術的ポイント**:
- `dynamic_cast` の使用
- 仮想関数テーブルの理解
- 実行時型判定の仕組み
- ポリモーフィズムとRTTIの関係

---

## 技術的詳細

### 型変換（Type Casting）

C++では以下の型変換が可能です：

- **静的キャスト（`static_cast`）**: コンパイル時に型を変換
- **動的キャスト（`dynamic_cast`）**: 実行時に型の安全性をチェック
- **定数キャスト（`const_cast`）**: const修飾子の除去
- **再解釈キャスト（`reinterpret_cast`）**: ビットレベルの再解釈

### シリアライゼーション

データを永続化するための技術：

- メモリ上のオブジェクトをバイト列に変換
- ファイルやネットワーク経由でのデータ転送
- 後で同じ構造のオブジェクトを復元

### RTTI（Run-Time Type Information）

実行時にオブジェクトの型情報を取得：

- 仮想関数テーブル（vtable）の活用
- `typeid` 演算子による型情報取得
- `dynamic_cast` による安全な型変換

---

## ビルドと実行方法

各課題はそれぞれのディレクトリにあり、独自のMakefileが含まれています。

### ex00 - Convert scalar types

```bash
cd ex00
make
./convert "42"
./convert "42.0f"
./convert "a"
./convert "nan"
```

### ex01 - Serialize data!

```bash
cd ex01
make
./serialize
```

### ex02 - Identify real type

```bash
cd ex02
make
./identify
```

---

## 学習目標

このモジュールを通じて以下を習得します：

1. **型安全性の理解**: 適切な型変換の選択と実装
2. **データ永続化**: オブジェクトの保存と復元の仕組み
3. **実行時型情報**: ポリモーフィズムとRTTIの活用
4. **メモリ管理**: ポインタ操作とメモリ安全性
5. **エラーハンドリング**: 型変換失敗時の適切な処理

---

## 注意事項

- 型変換は慎重に行い、データの整合性を保つこと
- シリアライゼーションではエンディアンの違いに注意
- RTTIは仮想関数を持つクラスでのみ有効
- メモリリークやダングリングポインタに注意